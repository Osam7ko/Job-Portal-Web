<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:th="https://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Job Seeker Profile Setup</title>

    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap"
          rel="stylesheet"/>

    <style>
        /* Enhanced Modern Styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f9fa;
        }

        .page-wrap {
            min-height: 100vh;
        }

        .card-modern {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
            background: #ffffff;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e9ecef;
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            letter-spacing: 0.03em;
            color: #274a72;
            margin: 0;
            text-transform: uppercase;
        }

        .section-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #274a72 0%, #365a7e 100%);
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 0.75rem;
            font-size: 0.9rem;
        }

        .subtle-label {
            font-size: 0.875rem;
            color: #495057;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-control, .form-select {
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 0.625rem 0.875rem;
            font-size: 0.9375rem;
            transition: all 0.2s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #274a72;
            box-shadow: 0 0 0 0.2rem rgba(39, 74, 114, 0.15);
        }

        .pill {
            background: linear-gradient(135deg, #274a72 0%, #365a7e 100%);
            border-radius: 50px;
            padding: 0.5rem 1.25rem;
            font-size: 0.8125rem;
            color: white;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #dee2e6, transparent);
            margin: 2rem 0;
        }

        .btn-add {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            color: #274a72;
            font-weight: 600;
            padding: 0.5rem 1.25rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn-add:hover {
            background: #e9ecef;
            border-color: #274a72;
            color: #274a72;
        }

        .btn-remove {
            background: #fff;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .btn-remove:hover {
            background: #dc3545;
            color: white;
        }

        .repeater-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
            transition: all 0.2s ease;
        }

        .repeater-item:hover {
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.05);
        }

        .image-preview-container {
            margin-top: 1rem;
            text-align: center;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 0.75rem;
            border: 3px solid #e9ecef;
            object-fit: cover;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
        }

        .file-upload-label {
            display: block;
            padding: 0.75rem;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-upload-label:hover {
            background: #e9ecef;
            border-color: #274a72;
        }

        .file-upload-label i {
            font-size: 1.5rem;
            color: #274a72;
            margin-bottom: 0.5rem;
        }

        .base_button {
            background: linear-gradient(135deg, #fb4f14 0%, #ff6b3d 100%);
            border: none;
            padding: 0.875rem 3rem;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1rem rgba(251, 79, 20, 0.3);
            transition: all 0.3s ease;
        }

        .base_button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.75rem 1.5rem rgba(251, 79, 20, 0.4);
        }

        .form-check-input:checked {
            background-color: #274a72;
            border-color: #274a72;
        }

        .resume-link {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 0.5rem;
            color: #0066cc;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .resume-link:hover {
            background: #d0e9ff;
            color: #0052a3;
        }

        .resume-link i {
            margin-right: 0.5rem;
        }

        /* Smooth transitions for show/hide */
        .collapse-section {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .coffee_mug_background {
                display: none !important;
            }

            .card-modern {
                border-radius: 0;
            }

            .myForm > form {
                padding: 1.5rem !important;
            }
        }

        /* Loading state */
        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }

        .btn-loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.6s linear infinite;
        }

        @keyframes spinner {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
<div class="row page-wrap g-0">
    <!-- Left visual panel -->
    <div class="col-5 coffee_mug_background d-none d-md-block">
        <div class="logo_left mt-3 pt-4 ms-5 ps-5">
            <h2 class="logo text-white">
                findjobs <img alt="Logo" class="footer-logo" src="/assets/logosama.svg"><span
                    class="logo_com">.com</span>
            </h2>
        </div>
    </div>

    <!-- Right form panel -->
    <div class="col-12 col-md-7 d-flex align-items-start justify-content-center py-4">
        <div class="myForm w-100">
            <form class="card card-modern p-4 p-md-5 w-100 mx-auto"
                  enctype="multipart/form-data"
                  id="profileForm"
                  method="post"
                  style="max-width:900px"
                  th:action="@{/job-seeker-profile/addNew}"
                  th:object="${profile}">

                <!-- Header -->
                <div class="text-center mb-4">
                    <div class="pill d-inline-block mb-3">
                        <i class="fa fa-user me-2"></i>Candidate Profile
                    </div>
                    <h2 class="heading_font fw-bold mb-2">Set up your Profile</h2>
                    <p class="text-muted mb-0">Complete your profile to get noticed by recruiters</p>
                </div>

                <!-- Basic Info Section -->
                <div class="section-header">
                    <div class="d-flex align-items-center">
                        <span class="section-icon"><i class="fa fa-info"></i></span>
                        <h3 class="section-title">Basic Information</h3>
                    </div>
                </div>

                <input id="user_account_id" th:field="*{userAccountId}" type="hidden"/>

                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="subtle-label" for="firstName">First Name <span
                                class="text-danger">*</span></label>
                        <input class="form-control"
                               id="firstName"
                               placeholder="e.g. Osama"
                               required
                               th:field="*{firstName}"
                               type="text"/>
                    </div>
                    <div class="col-md-6">
                        <label class="subtle-label" for="lastName">Last Name <span class="text-danger">*</span></label>
                        <input class="form-control"
                               id="lastName"
                               placeholder="e.g. Khalid"
                               required
                               th:field="*{lastName}"
                               type="text"/>
                    </div>
                    <div class="col-md-4">
                        <label class="subtle-label" for="city">City</label>
                        <input class="form-control"
                               id="city"
                               placeholder="e.g. Riyadh"
                               th:field="*{city}"
                               type="text"/>
                    </div>
                    <div class="col-md-4">
                        <label class="subtle-label" for="state">State</label>
                        <input class="form-control"
                               id="state"
                               placeholder="e.g. Riyadh"
                               th:field="*{state}"
                               type="text"/>
                    </div>
                    <div class="col-md-4">
                        <label class="subtle-label" for="country">Country</label>
                        <input class="form-control"
                               id="country"
                               placeholder="e.g. KSA"
                               th:field="*{country}"
                               type="text"/>
                    </div>
                    <div class="col-md-6">
                        <label class="subtle-label" for="employmentType">Employment Status</label>
                        <select class="form-select" id="employmentType" th:field="*{employmentType}">
                            <option value="">Seeking Employment</option>
                            <option value="Full-Time">Full-time</option>
                            <option value="Part-Time">Part-time</option>
                            <option value="Freelance">Freelance</option>
                        </select>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Education Section -->
                <div class="section-header">
                    <div class="d-flex align-items-center">
                        <span class="section-icon"><i class="fa fa-graduation-cap"></i></span>
                        <h3 class="section-title">Education</h3>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input"
                               id="hasEducation"
                               th:checked="${#lists.size(profile.educations) > 0}"
                               type="checkbox">
                        <label class="form-check-label" for="hasEducation">
                            I have education to add
                        </label>
                    </div>
                </div>

                <div class="collapse-section"
                     id="educationSection"
                     th:classappend="${#lists.size(profile.educations) > 0 ? '' : 'd-none'}">

                    <div class="education-container">
                        <!-- Existing education entries -->
                        <div class="repeater-item" th:each="edu, iter : *{educations}">
                            <input th:field="*{educations[__${iter.index}__].id}" type="hidden"/>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="subtle-label">Education Level</label>
                                    <select class="form-select" th:field="*{educations[__${iter.index}__].level}">
                                        <option value="">Select Level</option>
                                        <option value="High School">High School</option>
                                        <option value="2-Year College">2-Year College</option>
                                        <option value="College-University">College/University</option>
                                    </select>
                                </div>
                                <div class="col-md-5">
                                    <label class="subtle-label">Institution Name</label>
                                    <input class="form-control"
                                           placeholder="e.g. Imam University"
                                           th:field="*{educations[__${iter.index}__].institutionName}"
                                           type="text"/>
                                </div>
                                <div class="col-md-4">
                                    <label class="subtle-label">Degree/GPA Range</label>
                                    <select class="form-select" th:field="*{educations[__${iter.index}__].degree}">
                                        <option value="">Select Range</option>
                                        <option value="5 - 4.75">5.00 - 4.75</option>
                                        <option value="4.30 - 4.75">4.75 - 4.30</option>
                                        <option value="4 - 4.30">4.30 - 4.00</option>
                                        <option value="3.5 - 4">4.00 - 3.50</option>
                                        <option value="Less than 3.5">Less than 3.50</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-add mt-3" id="addEducation" type="button">
                        <i class="fa fa-plus me-2"></i>Add Education
                    </button>
                </div>

                <div class="divider"></div>

                <!-- Experience Section -->
                <div class="section-header">
                    <div class="d-flex align-items-center">
                        <span class="section-icon"><i class="fa fa-briefcase"></i></span>
                        <h3 class="section-title">Work Experience</h3>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input"
                               id="hasExperience"
                               th:checked="${#lists.size(profile.experiences) > 0}"
                               type="checkbox">
                        <label class="form-check-label" for="hasExperience">
                            I have experience to add
                        </label>
                    </div>
                </div>

                <div class="collapse-section"
                     id="experienceSection"
                     th:classappend="${#lists.size(profile.experiences) > 0 ? '' : 'd-none'}">

                    <div class="experience-container">
                        <!-- Existing experience entries -->
                        <div class="repeater-item" th:each="exp, iter : *{experiences}">
                            <input th:field="*{experiences[__${iter.index}__].id}" type="hidden"/>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="subtle-label">Company Name</label>
                                    <input class="form-control"
                                           placeholder="e.g. Tech Corp"
                                           th:field="*{experiences[__${iter.index}__].company}"
                                           type="text"/>
                                </div>
                                <div class="col-md-4">
                                    <label class="subtle-label">Role/Position</label>
                                    <input class="form-control"
                                           placeholder="e.g. Backend Developer"
                                           th:field="*{experiences[__${iter.index}__].roleTitle}"
                                           type="text"/>
                                </div>
                                <div class="col-md-2">
                                    <label class="subtle-label">Years</label>
                                    <input class="form-control"
                                           min="0"
                                           th:field="*{experiences[__${iter.index}__].years}"
                                           type="number"/>
                                </div>
                                <div class="col-md-2">
                                    <label class="subtle-label">Proof <small>(optional)</small></label>
                                    <input accept="application/pdf,image/*"
                                           class="form-control form-control-sm"
                                           name="experienceProofs"
                                           type="file"/>
                                    <input th:field="*{experiences[__${iter.index}__].proofFile}" type="hidden"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-add mt-3" id="addExperience" type="button">
                        <i class="fa fa-plus me-2"></i>Add Experience
                    </button>
                </div>

                <div class="divider"></div>

                <!-- Skills Section -->
                <div class="section-header">
                    <div class="d-flex align-items-center">
                        <span class="section-icon"><i class="fa fa-code"></i></span>
                        <h3 class="section-title">Skills & Expertise</h3>
                    </div>
                    <button class="btn btn-add btn-sm" id="addSkill" type="button">
                        <i class="fa fa-plus me-2"></i>Add Skill
                    </button>
                </div>

                <div class="skills-container">
                    <!-- Existing skills -->
                    <div class="repeater-item" th:each="skill, iterStat : *{skills}">
                        <input th:field="*{skills[__${iterStat.index}__].id}" type="hidden"/>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="subtle-label">Skill Name</label>
                                <input class="form-control"
                                       placeholder="e.g. Java, Python, React"
                                       th:field="*{skills[__${iterStat.index}__].name}"
                                       type="text"/>
                            </div>
                            <div class="col-md-4">
                                <label class="subtle-label">Years of Experience</label>
                                <input class="form-control"
                                       placeholder="e.g. 3"
                                       th:field="*{skills[__${iterStat.index}__].yearsOfExperience}"
                                       type="text"/>
                            </div>
                            <div class="col-md-4">
                                <label class="subtle-label">Experience Level</label>
                                <select class="form-select"
                                        th:field="*{skills[__${iterStat.index}__].experienceLevel}">
                                    <option value="">Select Level</option>
                                    <option value="Beginner">Beginner</option>
                                    <option value="Intermediate">Intermediate</option>
                                    <option value="Advance">Advanced</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Links Section -->
                <div class="section-header">
                    <div class="d-flex align-items-center">
                        <span class="section-icon"><i class="fa fa-link"></i></span>
                        <h3 class="section-title">Professional Links <small class="text-muted">(Optional)</small></h3>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="subtle-label" for="linkedInUrl">
                            <i class="fa fa-linkedin me-2"></i>LinkedIn Profile
                        </label>
                        <input class="form-control"
                               id="linkedInUrl"
                               placeholder="https://linkedin.com/in/..."
                               th:field="*{linkedInUrl}"
                               type="url"/>
                    </div>
                    <div class="col-md-4">
                        <label class="subtle-label" for="githubUrl">
                            <i class="fa fa-github me-2"></i>GitHub Profile
                        </label>
                        <input class="form-control"
                               id="githubUrl"
                               placeholder="https://github.com/..."
                               th:field="*{githubUrl}"
                               type="url"/>
                    </div>
                    <div class="col-md-4">
                        <label class="subtle-label" for="portfolioUrl">
                            <i class="fa fa-globe me-2"></i>Portfolio Website
                        </label>
                        <input class="form-control"
                               id="portfolioUrl"
                               placeholder="https://..."
                               th:field="*{portfolioUrl}"
                               type="url"/>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Uploads Section -->
                <div class="section-header">
                    <div class="d-flex align-items-center">
                        <span class="section-icon"><i class="fa fa-upload"></i></span>
                        <h3 class="section-title">Documents & Media</h3>
                    </div>
                </div>

                <div class="row g-4 mb-4">
                    <!-- Profile Photo -->
                    <div class="col-md-6" sec:authorize="hasAuthority('Job Seeker')">
                        <label class="subtle-label">
                            <i class="fa fa-camera me-2"></i>Profile Photo
                        </label>

                        <div class="image-preview-container" id="photoPreviewContainer">
                            <img alt="Profile Photo"
                                 class="image-preview"
                                 id="photoPreview"
                                 th:if="${profile.photosImagePath != null}"
                                 th:src="@{${profile.photosImagePath}}"/>
                        </div>

                        <input accept="image/png, image/jpeg, image/jpg"
                               class="form-control mt-3"
                               id="profilePhotoInput"
                               name="image"
                               type="file"/>
                        <input th:field="*{profilePhoto}" type="hidden"/>
                        <small class="text-muted d-block mt-2">
                            <i class="fa fa-info-circle me-1"></i>Accepted formats: JPG, PNG (Max 5MB)
                        </small>
                    </div>

                    <!-- Resume -->
                    <div class="col-md-6">
                        <label class="subtle-label">
                            <i class="fa fa-file-pdf me-2"></i>Resume/CV
                            <span class="text-danger" th:if="${profile.resume == null}">*</span>
                        </label>

                        <!-- Show a link if a resume is already on file -->
                        <div class="mb-3"
                             th:if="${profile.resume != null and !#strings.isEmpty(profile.resume)}">
                            <a class="resume-link" target="_blank"
                               th:href="@{/download/resume(userId=${profile.userAccountId}, fileName=${profile.resume})}">
                                <i class="fa fa-file-pdf"></i>
                                View Current Resume
                            </a>
                        </div>

                        <input accept="application/pdf"
                               class="form-control"
                               id="resumeInput"
                               name="pdf"
                               sec:authorize="hasAuthority('Job Seeker')"
                               th:required="${profile.resume == null}"
                               type="file"/>
                        <small class="text-muted d-block mt-2">
                            <i class="fa fa-info-circle me-1"></i>PDF format only (Max 10MB)
                        </small>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="text-center mt-4" sec:authorize="hasAuthority('Job Seeker')">
                    <button class="btn btn-primary base_button"
                            id="submitBtn"
                            type="submit">
                        <i class="fa fa-save me-2"></i>Save Profile
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Scripts -->
<script th:src="@{/webjars/jquery/jquery.min.js}"></script>
<script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
<script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>

<!-- Disable everything for Recruiter viewers -->
<script sec:authorize="hasAuthority('Recruiter')">
    $(document).ready(function () {
        $("input, select, button, textarea").prop("disabled", true);
    });
</script>

<!-- Main Profile Form Scripts -->
<script th:inline="javascript">
    /*<![CDATA[*/
    $(document).ready(function () {

        // Initialize counters from server-side data
        var skillIndex = /*[[${#lists.size(profile.skills)}]]*/ 0;
        var eduIndex = /*[[${#lists.size(profile.educations)}]]*/ 0;
        var expIndex = /*[[${#lists.size(profile.experiences)}]]*/ 0;

        // ===== TOGGLE SECTIONS =====
        $('#hasEducation').on('change', function () {
            if (this.checked) {
                $('#educationSection').removeClass('d-none');
                // If no education exists, add one
                if ($('.education-container .repeater-item').length === 0) {
                    addEducationRow();
                }
            } else {
                $('#educationSection').addClass('d-none');
            }
        });

        $('#hasExperience').on('change', function () {
            if (this.checked) {
                $('#experienceSection').removeClass('d-none');
                // If no experience exists, add one
                if ($('.experience-container .repeater-item').length === 0) {
                    addExperienceRow();
                }
            } else {
                $('#experienceSection').addClass('d-none');
            }
        });

        // ===== ADD SKILL =====
        $('#addSkill').on('click', function (e) {
            e.preventDefault();
            addSkillRow();
        });

        function addSkillRow() {
            var i = skillIndex++;
            var html = `
                <div class="repeater-item">
                    <input type="hidden" name="skills[${i}].id"/>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="subtle-label">Skill Name</label>
                            <input class="form-control" 
                                   name="skills[${i}].name" 
                                   placeholder="e.g. Java, Python, React"
                                   type="text"/>
                        </div>
                        <div class="col-md-4">
                            <label class="subtle-label">Years of Experience</label>
                            <input class="form-control" 
                                   name="skills[${i}].yearsOfExperience" 
                                   placeholder="e.g. 3"
                                   type="text"/>
                        </div>
                        <div class="col-md-3">
                            <label class="subtle-label">Experience Level</label>
                            <select class="form-select" name="skills[${i}].experienceLevel">
                                <option value="">Select Level</option>
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advance">Advanced</option>
                            </select>
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button type="button" class="btn btn-remove w-100" onclick="$(this).closest('.repeater-item').remove();">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            $('.skills-container').append(html);
        }

        // ===== ADD EDUCATION =====
        $('#addEducation').on('click', function (e) {
            e.preventDefault();
            addEducationRow();
        });

        function addEducationRow() {
            var i = eduIndex++;
            var html = `
                <div class="repeater-item">
                    <input type="hidden" name="educations[${i}].id"/>
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="subtle-label">Education Level</label>
                            <select class="form-select" name="educations[${i}].level">
                                <option value="">Select Level</option>
                                <option value="High School">High School</option>
                                <option value="2-Year College">2-Year College</option>
                                <option value="College-University">College/University</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="subtle-label">Institution Name</label>
                            <input class="form-control" 
                                   name="educations[${i}].institutionName" 
                                   placeholder="e.g. Imam University"
                                   type="text"/>
                        </div>
                        <div class="col-md-3">
                            <label class="subtle-label">Degree/GPA Range</label>
                            <select class="form-select" name="educations[${i}].degree">
                                <option value="">Select Range</option>
                                <option value="5 - 4.75">5.00 - 4.75</option>
                                <option value="4.30 - 4.75">4.75 - 4.30</option>
                                <option value="4 - 4.30">4.30 - 4.00</option>
                                <option value="3.5 - 4">4.00 - 3.50</option>
                                <option value="Less than 3.5">Less than 3.50</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="button" class="btn btn-remove w-100" onclick="$(this).closest('.repeater-item').remove();">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            $('.education-container').append(html);
        }

        // ===== ADD EXPERIENCE =====
        $('#addExperience').on('click', function (e) {
            e.preventDefault();
            addExperienceRow();
        });

        function addExperienceRow() {
            var i = expIndex++;
            var html = `
                <div class="repeater-item">
                    <input type="hidden" name="experiences[${i}].id"/>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="subtle-label">Company Name</label>
                            <input class="form-control" 
                                   name="experiences[${i}].company" 
                                   placeholder="e.g. Tech Corp"
                                   type="text"/>
                        </div>
                        <div class="col-md-3">
                            <label class="subtle-label">Role/Position</label>
                            <input class="form-control" 
                                   name="experiences[${i}].roleTitle" 
                                   placeholder="e.g. Backend Developer"
                                   type="text"/>
                        </div>
                        <div class="col-md-2">
                            <label class="subtle-label">Years</label>
                            <input class="form-control" 
                                   name="experiences[${i}].years" 
                                   type="number"
                                   min="0"/>
                        </div>
                        <div class="col-md-2">
                            <label class="subtle-label">Proof <small>(opt)</small></label>
                            <input accept="application/pdf,image/*" 
                                   class="form-control form-control-sm" 
                                   name="experienceProofs"
                                   type="file"/>
                            <input type="hidden" name="experiences[${i}].proofFile"/>
                        </div>
                        <div class="col-md-1 d-flex align-items-end">
                            <button type="button" class="btn btn-remove w-100" onclick="$(this).closest('.repeater-item').remove();">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            $('.experience-container').append(html);
        }

        // ===== IMAGE PREVIEW =====
        $('#profilePhotoInput').on('change', function (e) {
            var file = e.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var preview = $('#photoPreview');
                    if (preview.length === 0) {
                        $('#photoPreviewContainer').html(
                            '<img id="photoPreview" class="image-preview" alt="Profile Photo Preview"/>'
                        );
                        preview = $('#photoPreview');
                    }
                    preview.attr('src', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // ===== FORM SUBMISSION =====
        $('#profileForm').on('submit', function () {
            var btn = $('#submitBtn');
            btn.addClass('btn-loading');
            btn.prop('disabled', true);
        });

        // ===== SMOOTH SCROLL TO ERRORS =====
        var firstError = $('.is-invalid:first');
        if (firstError.length) {
            $('html, body').animate({
                scrollTop: firstError.offset().top - 100
            }, 500);
        }
    });
    /*]]>*/
</script>
</body>
</html>